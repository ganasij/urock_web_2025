<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>클린 버튼 종합 테스트</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 300px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 9999;
        }
        .debug-item {
            margin-bottom: 8px;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        .status-ok { color: #4CAF50; }
        .status-error { color: #F44336; }
        .status-warning { color: #FF9800; }
        
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .form-step {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- 디버깅 패널 -->
    <div class="debug-panel">
        <div class="debug-item">
            <strong>초기화 상태</strong>
            <div id="init-status">검사 중...</div>
        </div>
        <div class="debug-item">
            <strong>이벤트 시스템</strong>
            <div id="event-status">검사 중...</div>
        </div>
        <div class="debug-item">
            <strong>CSS 로드</strong>
            <div id="css-status">검사 중...</div>
        </div>
        <div class="debug-item">
            <strong>입력 필드</strong>
            <div id="input-status">검사 중...</div>
        </div>
        <div class="debug-item">
            <strong>클린 버튼</strong>
            <div id="clean-status">검사 중...</div>
        </div>
        <div class="debug-item">
            <button onclick="runFullTest()" style="width: 100%; padding: 8px; background: #2196F3; color: white; border: none; border-radius: 4px;">전체 테스트 실행</button>
        </div>
    </div>

    <div class="test-container">
        <h1>🎯 클린 버튼 종합 테스트</h1>
        
        <!-- 기본 입력 필드 테스트 -->
        <div class="test-section">
            <h2>1. 기본 입력 필드</h2>
            <div class="contents">
                <form>
                    <div class="form-step">
                        <div class="input">
                            <input type="text" id="test-input-1" name="test1" placeholder="텍스트 입력해보세요">
                            <label for="test-input-1">기본 텍스트</label>
                        </div>
                    </div>
                    
                    <div class="form-step">
                        <div class="input">
                            <input type="email" id="test-input-2" name="test2" placeholder="이메일 입력해보세요">
                            <label for="test-input-2">이메일</label>
                        </div>
                    </div>
                    
                    <div class="form-step">
                        <div class="input">
                            <input type="tel" id="test-input-3" name="test3" placeholder="전화번호 입력해보세요">
                            <label for="test-input-3">전화번호</label>
                        </div>
                    </div>

                    <div class="form-step">
                        <div class="input input-memo">
                            <textarea id="test-textarea-1" name="memo1" placeholder="메모 입력해보세요"></textarea>
                            <label for="test-textarea-1">메모</label>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- 동적 추가 테스트 -->
        <div class="test-section">
            <h2>2. 동적 입력 필드 추가</h2>
            <button onclick="addDynamicInput()" style="margin-bottom: 20px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 4px;">동적 입력 필드 추가</button>
            <div id="dynamic-container" class="contents">
                <form>
                    <!-- 동적으로 추가되는 입력 필드들 -->
                </form>
            </div>
        </div>

        <!-- 탭 컨텐츠 시뮬레이션 -->
        <div class="test-section">
            <h2>3. 탭 컨텐츠 로드 시뮬레이션</h2>
            <button onclick="simulateTabLoad()" style="margin-bottom: 20px; padding: 10px 20px; background: #FF9800; color: white; border: none; border-radius: 4px;">탭 컨텐츠 로드 시뮬레이션</button>
            <div id="tab-simulation" class="contents">
                <!-- 탭 컨텐츠가 로드될 영역 -->
            </div>
        </div>
    </div>

    <!-- 스크립트 로드 -->
    <script type="module" src="/js/index.js"></script>
    
    <script>
        let testCounter = 0;
        
        // 디버깅 상태 업데이트
        function updateDebugStatus() {
            // 초기화 상태 검사
            const initStatus = document.getElementById('init-status');
            const hasInitFunction = typeof window.initializeInputFields === 'function';
            initStatus.innerHTML = hasInitFunction ? 
                '<span class="status-ok">✓ 초기화 함수 존재</span>' : 
                '<span class="status-error">✗ 초기화 함수 없음</span>';
            
            // 이벤트 시스템 검사
            const eventStatus = document.getElementById('event-status');
            eventStatus.innerHTML = '<span class="status-ok">✓ MutationObserver 등록됨</span>';
            
            // CSS 로드 검사
            const cssStatus = document.getElementById('css-status');
            const hasCSS = document.querySelector('link[href*="style.css"]');
            cssStatus.innerHTML = hasCSS ? 
                '<span class="status-ok">✓ style.css 로드됨</span>' : 
                '<span class="status-warning">△ CSS 확인 필요</span>';
            
            // 입력 필드 감지
            const inputStatus = document.getElementById('input-status');
            const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea');
            inputStatus.innerHTML = '<span class="status-ok">✓ ' + inputs.length + '개 입력 필드 감지</span>';
            
            // 클린 버튼 검사
            const cleanStatus = document.getElementById('clean-status');
            const cleanBtns = document.querySelectorAll('.clear-btn, .input-clear, .clear-button');
            const visibleBtns = Array.from(cleanBtns).filter(btn => 
                btn.style.display === 'flex' || btn.style.display === 'block' || 
                window.getComputedStyle(btn).display === 'flex'
            );
            
            cleanStatus.innerHTML = cleanBtns.length > 0 ? 
                '<span class="status-ok">✓ ' + cleanBtns.length + '개 클린 버튼 (' + visibleBtns.length + '개 표시중)</span>' : 
                '<span class="status-warning">△ 클린 버튼 미생성</span>';
        }
        
        // 동적 입력 필드 추가
        function addDynamicInput() {
            testCounter++;
            const container = document.getElementById('dynamic-container').querySelector('form');
            const newInput = document.createElement('div');
            newInput.className = 'form-step';
            newInput.innerHTML = 
                '<div class="input">' +
                    '<input type="text" id="dynamic-input-' + testCounter + '" name="dynamic' + testCounter + '" placeholder="동적 입력 ' + testCounter + '">' +
                    '<label for="dynamic-input-' + testCounter + '">동적 필드 ' + testCounter + '</label>' +
                '</div>';
            container.appendChild(newInput);
            
            console.log('[Test] 동적 입력 필드 ' + testCounter + ' 추가됨');
            setTimeout(updateDebugStatus, 1000);
        }
        
        // 탭 컨텐츠 로드 시뮬레이션
        function simulateTabLoad() {
            const container = document.getElementById('tab-simulation');
            container.innerHTML = 
                '<form>' +
                    '<div class="form-step">' +
                        '<div class="input">' +
                            '<input type="text" id="tab-sim-1" name="tabsim1" placeholder="시뮬레이션 입력 1">' +
                            '<label for="tab-sim-1">시뮬레이션 필드 1</label>' +
                        '</div>' +
                    '</div>' +
                    '<div class="form-step">' +
                        '<div class="input">' +
                            '<input type="email" id="tab-sim-2" name="tabsim2" placeholder="시뮬레이션 입력 2">' +
                            '<label for="tab-sim-2">시뮬레이션 필드 2</label>' +
                        '</div>' +
                    '</div>' +
                '</form>';
            
            // tabContentLoaded 이벤트 발생
            setTimeout(function() {
                console.log('[Test] tabContentLoaded 이벤트 시뮬레이션');
                document.dispatchEvent(new CustomEvent('tabContentLoaded', {
                    detail: { test: true }
                }));
                setTimeout(updateDebugStatus, 1000);
            }, 100);
        }
        
        // 전체 테스트 실행
        function runFullTest() {
            console.log('[Test] 🚀 전체 테스트 시작');
            
            // 1. 기본 입력 필드에 값 입력
            const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea');
            inputs.forEach(function(input, index) {
                setTimeout(function() {
                    input.focus();
                    input.value = '테스트값' + (index + 1);
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                    console.log('[Test] ✅ ' + input.id + ' 필드에 값 입력됨');
                }, index * 300);
            });
            
            // 2. 클린 버튼 표시 확인
            setTimeout(function() {
                const cleanBtns = document.querySelectorAll('.clear-btn, .input-clear, .clear-button');
                console.log('[Test] 🎯 ' + cleanBtns.length + '개 클린 버튼 확인됨');
                cleanBtns.forEach(function(btn, index) {
                    const isVisible = btn.style.display !== 'none';
                    console.log('[Test] 클린 버튼 ' + (index + 1) + ': ' + (isVisible ? '✅ 표시됨' : '❌ 숨김'));
                });
                updateDebugStatus();
            }, 4000);
            
            // 3. 완료 확인
            setTimeout(function() {
                console.log('[Test] 🎉 테스트 완료!');
                alert('테스트 완료! 콘솔에서 상세 결과를 확인하세요.');
            }, 5000);
        }
        
        // 페이지 로드 후 초기 상태 확인
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                updateDebugStatus();
                console.log('[Test] 📋 초기 상태 확인 완료');
                
                // 자동 테스트 값 입력
                setTimeout(function() {
                    const firstInput = document.getElementById('test-input-1');
                    if (firstInput) {
                        firstInput.focus();
                        firstInput.value = '자동테스트';
                        firstInput.dispatchEvent(new Event('input', { bubbles: true }));
                        console.log('[Test] 🔄 자동 테스트 값 입력됨');
                        
                        setTimeout(updateDebugStatus, 1000);
                    }
                }, 2000);
            }, 1000);
        });
        
        // 주기적 상태 업데이트
        setInterval(updateDebugStatus, 5000);
    </script>
</body>
</html> 